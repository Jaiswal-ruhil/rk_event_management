<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#3B82F6">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Event Manager">
  <title>Event Manager - Banquet Hall</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    * { -webkit-tap-highlight-color: transparent; }
    body { overscroll-behavior-y: contain; margin: 0; }
    .modal-backdrop { backdrop-filter: blur(4px); }
  </style>
</head>
<body>
  <div id="root"></div>

  <script>
    // Register Service Worker
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/rk_event_management/service-worker.js', {
          scope: '/rk_event_management/'
        }).then(registration => {
            console.log('ServiceWorker registration successful');
          })
          .catch(err => {
            console.log('ServiceWorker registration failed: ', err);
          });
      });
    }
  </script>
  <script type="text/babel">
    const { useState, useEffect } = React;

    const ROLE_OPTIONS = [
      { id: 'self', label: 'Self', color: 'bg-blue-500' },
      { id: 'event-manager', label: 'Event Manager', color: 'bg-indigo-500' },
      { id: 'venue', label: 'Venue', color: 'bg-green-500' },
      { id: 'caterer', label: 'Caterer', color: 'bg-orange-500' },
      { id: 'decorator', label: 'Decorator', color: 'bg-purple-500' },
      { id: 'vendor', label: 'Vendor', color: 'bg-pink-500' },
      { id: 'client', label: 'Client', color: 'bg-teal-500' },
      { id: 'other', label: 'Other', color: 'bg-gray-500' }
    ];

    const SERVICES_DATA = {
      core: { 
        title: "Core Venue Services", 
        color: "bg-blue-500", 
        items: [
          { name: "Hall Rental", deps: [] },
          { name: "Furniture (Tables, Chairs)", deps: ["Hall Rental"] },
          { name: "Climate Control (AC/Heating)", deps: ["Hall Rental"] },
          { name: "Parking Management", deps: ["Hall Rental"] },
          { name: "Security Services", deps: ["Hall Rental"] }
        ]
      },
      catering: { 
        title: "Catering & Food Services", 
        color: "bg-green-500", 
        items: [
          { name: "In-house Catering", deps: ["Hall Rental"] },
          { name: "Multi-cuisine Options", deps: ["In-house Catering"] },
          { name: "Custom Menu Planning", deps: ["In-house Catering"] },
          { name: "Bar Services (Alcohol)", deps: ["Hall Rental"] },
          { name: "Cake & Dessert Services", deps: ["In-house Catering"] },
          { name: "Live Cooking Stations", deps: ["In-house Catering"] },
          { name: "Catering Staff", deps: ["In-house Catering"] }
        ]
      },
      decoration: { 
        title: "Decoration & Theming", 
        color: "bg-purple-500", 
        items: [
          { name: "Stage Decoration", deps: ["Hall Rental"] },
          { name: "Floral Arrangements", deps: ["Hall Rental"] },
          { name: "Theme-based Decor", deps: ["Hall Rental"] },
          { name: "Lighting Design", deps: ["Hall Rental"] },
          { name: "Entrance Decoration", deps: ["Hall Rental"] },
          { name: "Table Settings", deps: ["Furniture"] }
        ]
      },
      entertainment: { 
        title: "Entertainment Services", 
        color: "bg-pink-500", 
        items: [
          { name: "DJ Services", deps: ["Sound System"] },
          { name: "Live Band", deps: ["Sound System"] },
          { name: "MC/Anchor Services", deps: ["Hall Rental"] },
          { name: "Dance Floor Setup", deps: ["Hall Rental"] },
          { name: "Traditional Performers", deps: ["Hall Rental"] },
          { name: "Photo Booth", deps: ["Hall Rental"] }
        ]
      },
      tech: { 
        title: "Technology & AV", 
        color: "bg-orange-500", 
        items: [
          { name: "Sound System", deps: ["Hall Rental"] },
          { name: "Projector & Screen", deps: ["Hall Rental"] },
          { name: "Microphones (Wireless/Wired)", deps: ["Sound System"] },
          { name: "LED Screens", deps: ["Hall Rental"] },
          { name: "Photography Services", deps: ["Hall Rental"] },
          { name: "Videography Services", deps: ["Hall Rental"] },
          { name: "Live Streaming", deps: ["Hall Rental"] }
        ]
      },
      planning: { 
        title: "Event Planning & Management", 
        color: "bg-indigo-500", 
        items: [
          { name: "Event Planning/Coordination", deps: ["Hall Rental"] },
          { name: "Guest List Management", deps: ["Hall Rental"] },
          { name: "RSVP Tracking", deps: ["Guest List Management"] },
          { name: "Seating Arrangement Planning", deps: ["Guest List Management"] },
          { name: "Timeline & Schedule Management", deps: ["Event Planning/Coordination"] }
        ]
      },
      design: { 
        title: "Design & Printing Services", 
        color: "bg-cyan-500", 
        items: [
          { name: "Invitation Card Design", deps: [] },
          { name: "Invitation Card Printing", deps: ["Invitation Card Design"] },
          { name: "Menu Card Design", deps: [] },
          { name: "Signage & Banner Design", deps: [] },
          { name: "Thank You Card Design", deps: [] },
          { name: "Event Branding Design", deps: [] }
        ]
      },
      additional: { 
        title: "Additional Services", 
        color: "bg-teal-500", 
        items: [
          { name: "Valet Parking", deps: ["Parking Management"] },
          { name: "Guest Accommodation Assistance", deps: ["Hall Rental"] },
          { name: "Transportation Coordination", deps: ["Hall Rental"] },
          { name: "Gift Packaging Services", deps: [] },
          { name: "Childcare Services", deps: ["Hall Rental"] },
          { name: "Bridal Room Setup", deps: ["Hall Rental"] }
        ]
      }
    };

    const Icons = {
      ChevronDown: () => (
        <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" />
        </svg>
      ),
      ChevronRight: () => (
        <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" />
        </svg>
      ),
      CheckCircle2: () => (
        <svg className="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
        </svg>
      ),
      Circle: () => (
        <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <circle cx="12" cy="12" r="10" strokeWidth={2}/>
        </svg>
      ),
      XCircle: () => (
        <svg className="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11H7v-2h10v2z"/>
        </svg>
      ),
      User: () => (
        <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
        </svg>
      ),
      UserPlus: () => (
        <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z" />
        </svg>
      ),
      X: () => (
        <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
        </svg>
      ),
      Calendar: () => (
        <svg className="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
        </svg>
      )
    };

    const ContactSelector = ({ isOpen, onClose, selectedContacts, onSave }) => {
      const [contacts, setContacts] = useState(selectedContacts || []);
      const [newContact, setNewContact] = useState({ name: '', phone: '', role: '' });
      const [showAddForm, setShowAddForm] = useState(false);

      if (!isOpen) return null;

      const addContact = () => {
        if (newContact.name && newContact.phone) {
          setContacts([...contacts, { id: Date.now().toString(), ...newContact }]);
          setNewContact({ name: '', phone: '', role: '' });
          setShowAddForm(false);
        }
      };

      const getRoleColor = (roleId) => {
        const role = ROLE_OPTIONS.find(r => r.id === roleId);
        return role ? role.color : 'bg-gray-500';
      };

      const getRoleLabel = (roleId) => {
        const role = ROLE_OPTIONS.find(r => r.id === roleId);
        return role ? role.label : roleId;
      };

      return (
        <div className="fixed inset-0 bg-black bg-opacity-50 modal-backdrop flex items-center justify-center z-50 p-4" onClick={onClose}>
          <div className="bg-white rounded-lg p-6 max-w-lg w-full max-h-[80vh] overflow-auto" onClick={(e) => e.stopPropagation()}>
            <div className="flex justify-between items-center mb-4">
              <h3 className="text-xl font-bold text-gray-800">Assign Contacts</h3>
              <button onClick={onClose} className="text-gray-500 hover:text-gray-700 p-2">
                <Icons.X />
              </button>
            </div>

            <div className="space-y-3 mb-4">
              {contacts.map(contact => (
                <div key={contact.id} className="bg-gray-50 p-3 rounded-lg flex justify-between items-start">
                  <div className="flex-1">
                    <div className="font-semibold text-gray-800">{contact.name}</div>
                    <div className="text-sm text-gray-600">{contact.phone}</div>
                    {contact.role && (
                      <span className={`inline-block text-xs px-2 py-1 rounded mt-1 ${getRoleColor(contact.role)} text-white`}>
                        {getRoleLabel(contact.role)}
                      </span>
                    )}
                  </div>
                  <button 
                    onClick={() => setContacts(contacts.filter(c => c.id !== contact.id))} 
                    className="text-red-500 hover:text-red-700 ml-2 p-1"
                  >
                    <Icons.X />
                  </button>
                </div>
              ))}
            </div>

            {!showAddForm ? (
              <button 
                onClick={() => setShowAddForm(true)} 
                className="w-full p-3 border-2 border-dashed border-gray-300 rounded-lg text-gray-600 hover:border-blue-500 hover:text-blue-500 transition-colors flex items-center justify-center gap-2"
              >
                <Icons.UserPlus /> Add Contact
              </button>
            ) : (
              <div className="bg-blue-50 p-4 rounded-lg space-y-3">
                <input 
                  type="text" 
                  placeholder="Name *" 
                  value={newContact.name} 
                  onChange={(e) => setNewContact({ ...newContact, name: e.target.value })} 
                  className="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-base" 
                />
                <input 
                  type="tel" 
                  placeholder="Phone *" 
                  value={newContact.phone} 
                  onChange={(e) => setNewContact({ ...newContact, phone: e.target.value })} 
                  className="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-base" 
                />
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">Role (Optional)</label>
                  <div className="grid grid-cols-2 gap-2">
                    {ROLE_OPTIONS.map(role => (
                      <button 
                        key={role.id} 
                        onClick={() => setNewContact({ ...newContact, role: role.id })} 
                        className={`p-3 rounded-lg text-sm transition-all ${newContact.role === role.id ? `${role.color} text-white` : 'bg-white border border-gray-300 text-gray-700'}`}
                      >
                        {role.label}
                      </button>
                    ))}
                  </div>
                  {newContact.role && (
                    <button 
                      onClick={() => setNewContact({ ...newContact, role: '' })} 
                      className="mt-2 text-sm text-gray-600 hover:text-gray-800 underline"
                    >
                      Clear selection
                    </button>
                  )}
                </div>
                <div className="flex gap-2">
                  <button 
                    onClick={() => { setShowAddForm(false); setNewContact({ name: '', phone: '', role: '' }); }} 
                    className="flex-1 px-4 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 font-medium"
                  >
                    Cancel
                  </button>
                  <button 
                    onClick={addContact} 
                    disabled={!newContact.name || !newContact.phone} 
                    className="flex-1 px-4 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed font-medium"
                  >
                    Add
                  </button>
                </div>
              </div>
            )}

            <div className="flex gap-3 mt-6">
              <button 
                onClick={onClose} 
                className="flex-1 px-4 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 font-medium"
              >
                Cancel
              </button>
              <button 
                onClick={() => { onSave(contacts); onClose(); }} 
                className="flex-1 px-4 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 font-medium"
              >
                Save ({contacts.length})
              </button>
            </div>
          </div>
        </div>
      );
    };

    const ServiceItem = ({ service, status, onToggle, onMarkNotRequired, contacts, onAssignContacts }) => {
      const getIcon = () => {
        if (status === 'completed') return <Icons.CheckCircle2 />;
        if (status === 'not-required') return <Icons.XCircle />;
        return <Icons.Circle />;
      };

      const styles = status === 'completed' 
        ? { border: 'border-green-500', bg: 'bg-green-50', text: 'text-green-700 line-through' } 
        : status === 'not-required' 
        ? { border: 'border-red-500', bg: 'bg-red-50', text: 'text-red-700 line-through' }
        : { border: 'border-gray-300', bg: '', text: 'text-gray-800' };

      const getRoleColor = (roleId) => {
        const role = ROLE_OPTIONS.find(r => r.id === roleId);
        return role ? role.color : 'bg-blue-500';
      };

      const contactsList = contacts || [];

      return (
        <div className={`border-l-4 ${styles.border} ${styles.bg} pl-4 py-3 transition-colors rounded-r flex items-start gap-3`}>
          <div onClick={onToggle} className="flex-1 active:opacity-70 flex items-start gap-3">
            <div className="mt-0.5">{getIcon()}</div>
            <div className="flex-1">
              <div className={`font-semibold ${styles.text}`}>{service.name}</div>
              {service.deps.length > 0 && (
                <div className="text-sm text-gray-600 mt-1">
                  <span className="text-gray-500">Dependencies:</span> {service.deps.join(", ")}
                </div>
              )}
              {contactsList.length > 0 && (
                <div className="flex flex-wrap gap-1 mt-2">
                  {contactsList.map(contact => (
                    <span 
                      key={contact.id} 
                      className={`text-xs px-2 py-1 rounded ${contact.role ? getRoleColor(contact.role) : 'bg-blue-500'} text-white`}
                    >
                      {contact.name}
                    </span>
                  ))}
                </div>
              )}
            </div>
          </div>
          <div className="flex gap-2">
            <button 
              onClick={(e) => { e.stopPropagation(); onAssignContacts(); }} 
              className={`mt-0.5 p-2 rounded-lg transition-all ${contactsList.length > 0 ? 'bg-blue-500 text-white' : 'bg-gray-200 text-gray-600'}`}
            >
              <Icons.User />
            </button>
            <button 
              onClick={(e) => { e.stopPropagation(); onMarkNotRequired(); }} 
              className={`mt-0.5 p-2 rounded-lg transition-all ${status === 'not-required' ? 'bg-red-500 text-white' : 'bg-gray-200 text-gray-600'}`}
            >
              <Icons.XCircle />
            </button>
          </div>
        </div>
      );
    };

    const BanquetEventApp = () => {
      const [expandedCategories, setExpandedCategories] = useState({ core: true });
      const [serviceStatuses, setServiceStatuses] = useState({});
      const [assignedContacts, setAssignedContacts] = useState({});
      const [modalOpen, setModalOpen] = useState(false);
      const [currentService, setCurrentService] = useState(null);

      useEffect(() => {
        const saved = localStorage.getItem('eventManagerData');
        if (saved) {
          const data = JSON.parse(saved);
          if (data.serviceStatuses) setServiceStatuses(data.serviceStatuses);
          if (data.assignedContacts) setAssignedContacts(data.assignedContacts);
        }
      }, []);

      useEffect(() => {
        localStorage.setItem('eventManagerData', JSON.stringify({ 
          serviceStatuses, 
          assignedContacts 
        }));
      }, [serviceStatuses, assignedContacts]);

      const toggleService = (category, serviceName) => {
        const key = `${category}-${serviceName}`;
        setServiceStatuses(prev => {
          const newState = { ...prev };
          if (prev[key] === 'completed') {
            delete newState[key];
          } else {
            newState[key] = 'completed';
          }
          return newState;
        });
      };

      const toggleNotRequired = (category, serviceName) => {
        const key = `${category}-${serviceName}`;
        setServiceStatuses(prev => {
          const newState = { ...prev };
          if (prev[key] === 'not-required') {
            delete newState[key];
          } else {
            newState[key] = 'not-required';
          }
          return newState;
        });
      };

      const getTotalProgress = () => {
        let completed = 0;
        let notRequired = 0;
        let total = 0;
        
        Object.entries(SERVICES_DATA).forEach(([key, category]) => {
          category.items.forEach(item => {
            total++;
            const status = serviceStatuses[`${key}-${item.name}`];
            if (status === 'completed') completed++;
            if (status === 'not-required') notRequired++;
          });
        });
        
        return { completed, total, applicable: total - notRequired, notRequired };
      };

      const totalProgress = getTotalProgress();
      const percentage = totalProgress.applicable > 0 
        ? Math.round((totalProgress.completed / totalProgress.applicable) * 100) 
        : 0;

      return (
        <div className="w-full min-h-screen bg-gradient-to-br from-slate-50 to-slate-100">
          <ContactSelector
            isOpen={modalOpen}
            onClose={() => setModalOpen(false)}
            selectedContacts={currentService ? assignedContacts[`${currentService.category}-${currentService.serviceName}`] : []}
            onSave={(contacts) => {
              if (currentService) {
                const key = `${currentService.category}-${currentService.serviceName}`;
                setAssignedContacts(prev => {
                  const newState = { ...prev };
                  if (contacts.length > 0) {
                    newState[key] = contacts;
                  } else {
                    delete newState[key];
                  }
                  return newState;
                });
              }
            }}
          />

          <div className="bg-white shadow-md sticky top-0 z-10">
            <div className="max-w-6xl mx-auto px-4 py-4">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-3">
                  <Icons.Calendar />
                  <div>
                    <h1 className="text-xl font-bold text-gray-800">Event Manager</h1>
                    <p className="text-xs text-gray-600">Banquet Hall Services</p>
                  </div>
                </div>
                <div className="text-right">
                  <div className="text-xs text-gray-600">Progress</div>
                  <div className="text-lg font-bold text-blue-600">{percentage}%</div>
                </div>
              </div>
            </div>
          </div>

          <div className="max-w-6xl mx-auto p-4">
            <div className="bg-white rounded-lg shadow-lg p-4 mb-4">
              <div className="bg-gradient-to-r from-blue-50 to-purple-50 p-4 rounded-lg">
                <div className="flex justify-between items-center mb-2">
                  <span className="font-semibold text-gray-700 text-sm">Overall Progress</span>
                  <span className="text-base font-bold text-gray-800">
                    {totalProgress.completed} / {totalProgress.applicable}
                  </span>
                </div>
                <div className="w-full bg-gray-200 rounded-full h-4 overflow-hidden">
                  <div 
                    className="bg-gradient-to-r from-blue-500 to-purple-500 h-full transition-all duration-500 flex items-center justify-center text-xs font-bold text-white" 
                    style={{ width: `${percentage}%` }}
                  >
                    {percentage > 10 && `${percentage}%`}
                  </div>
                </div>
              </div>
            </div>

            <div className="space-y-3">
              {Object.entries(SERVICES_DATA).map(([key, category]) => {
                const completed = category.items.filter(item => 
                  serviceStatuses[`${key}-${item.name}`] === 'completed'
                ).length;
                const notRequired = category.items.filter(item => 
                  serviceStatuses[`${key}-${item.name}`] === 'not-required'
                ).length;
                const applicable = category.items.length - notRequired;
                const catPercentage = applicable > 0 
                  ? Math.round((completed / applicable) * 100) 
                  : 0;

                return (
                  <div key={key} className="bg-white rounded-lg shadow-md overflow-hidden">
                    <button 
                      onClick={() => setExpandedCategories(prev => ({ ...prev, [key]: !prev[key] }))} 
                      className={`w-full ${category.color} text-white p-4 flex items-center justify-between active:opacity-90 transition-opacity`}
                    >
                      <span className="text-base font-semibold">{category.title}</span>
                      <span className="flex items-center gap-3">
                        <span className="text-sm bg-white bg-opacity-20 px-3 py-1 rounded-full">
                          {completed}/{applicable} ({catPercentage}%)
                        </span>
                        {expandedCategories[key] ? <Icons.ChevronDown /> : <Icons.ChevronRight />}
                      </span>
                    </button>
                    
                    {expandedCategories[key] && (
                      <div className="p-3">
                        <div className="grid gap-2">
                          {category.items.map((service, idx) => (
                            <ServiceItem
                              key={idx}
                              service={service}
                              status={serviceStatuses[`${key}-${service.name}`]}
                              onToggle={() => toggleService(key, service.name)}
                              onMarkNotRequired={() => toggleNotRequired(key, service.name)}
                              contacts={assignedContacts[`${key}-${service.name}`]}
                              onAssignContacts={() => {
                                setCurrentService({ category: key, serviceName: service.name });
                                setModalOpen(true);
                              }}
                            />
                          ))}
                        </div>
                      </div>
                    )}
                  </div>
                );
              })}
            </div>

            <div className="bg-blue-50 border-l-4 border-blue-500 p-4 mt-4 rounded-lg">
              <div className="text-sm text-gray-700">
                <div className="font-bold mb-2">How to use:</div>
                <div className="ml-4 space-y-1">
                  <div>â€¢ Tap checkbox to toggle completion</div>
                  <div>â€¢ Tap person icon to assign contacts</div>
                  <div>â€¢ Tap X button to mark as not required</div>
                </div>
              </div>
            </div>

            <div className="bg-green-50 border-l-4 border-green-500 p-4 mt-4 rounded-lg mb-6">
              <div className="text-sm text-gray-700">
                <div className="font-bold mb-2">ðŸ“± Install as App:</div>
                <div className="ml-4 space-y-1">
                  <div>â€¢ iPhone: Safari â†’ Share â†’ Add to Home Screen</div>
                  <div>â€¢ Android: Chrome â†’ Menu (â‹®) â†’ Install App</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      );
    };

    ReactDOM.render(<BanquetEventApp />, document.getElementById('root'));
  </script>
</body>
</html>